@using TarimCan.Models

@model HayvanDetayResponseModel

@{
    ViewBag.Title = "Hayvan Detay";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/DashboardTheme/LightBox/css/lightbox.css" rel="stylesheet" />

<div class="col-md-12">

    <div class="portlet light bordered" style="min-height:620px">
        <div class="row">
            <div class="col-md-12">
                <div class="row" style="min-height:300px;">
                    <div class="col-md-12" id="pnlHayvanBilgileri">
                        <div class="portlet light" style="padding:0 !important; font-size:13px !important; margin:0px !important">
                            <div class="portlet-title" style="margin-bottom:0px !important">
                                <div class="caption">
                                    <i class="icon-equalizer font-red-sunglo"></i>
                                    <span class="caption-subject font-red-sunglo bold uppercase" style="font-size:15px">HAYVAN BİLGİLERİ</span>
                                </div>
                            </div>
                        </div>

                        <div class="portlet-body">
                            <div id="pnlHayvanBilgiLoading" style="width:100%; height:250px; text-align:center; display:none">
                                <img src="~/DashboardTheme/assets/admin/layout4/img/app_loading.gif" width="75" height="75" />
                            </div>

                            <div class="col-md-12" style="margin: 0 !important; padding: 0 !important">
                                <table class="table table-hover table-light">
                                    <tbody>

                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Sürü Bilgisi: </td>
                                            <td width="23%" id="dtyAdi"> @Model.HayvanDetay.SuruGrubu </td>
                                            <td width="10%" style="font-weight:bold"> Cinsiyeti: </td>
                                            <td width="23%" id="dtyCinsiyeti"> @Model.HayvanDetay.Cinsiyet </td>
                                            <td width="10%" style="font-weight:bold"> Sağmal Durumu: </td>
                                            <td width="23%" id="dtyAdi"> @Model.HayvanDetay.SagmalDurumu </td>
                                        </tr>
                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Son Doğum Yaptığı Tarih: </td>
                                            <td width="23%" id="dtySuruyeGirisTipi">
                                                @if (Model.HayvanDetay.CinsiyetId == 1 && Model.HayvanDetay.SonDogumYaptigiTarihFormatted != "01.01.9999")
                                                {
                                                    @Model.HayvanDetay.SonDogumYaptigiTarihFormatted
                                                }
                                            </td>
                                            <td width="10%" style="font-weight:bold"> SGS: </td>
                                            <td width="23%" id="dtyAdi"> @Model.HayvanDetay.SGS </td>
                                            <td width="10%" style="font-weight:bold"> Gebelik Durumu: </td>
                                            <td width="23%" id="dtyAdi">
                                                @if (Model.HayvanDetay.GebelikDurumId != 0)
                                                {
                                                    <span>Gebe</span>
                                                }
                                                else
                                                {
                                                    <span>Gebe Değil</span>
                                                }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Son Tohumlanma Tarihi: </td>
                                            <td width="23%" id="dtyAdi">
                                                @if (Model.HayvanDetay.TohumlanmaTarihi != null)
                                                {
                                                    @Model.HayvanDetay.TohumlanmaTarihi.Value.ToString("dd.MM.yyyy")
                                                }
                                            </td>
                                            <td width="10%" style="font-weight:bold"> Kilosu: </td>
                                            <td width="23%"> @Model.HayvanDetay.Kilosu </td>
                                            <td width="10%" style="font-weight:bold"> Tohumlanma Sayısı: </td>
                                            <td width="23%" id="dtyAdi"> @Model.HayvanDetay.TohumlanmaSayisi </td>
                                        </tr>

                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Küpe No: </td>
                                            <td width="23%">
                                                <input type="text" class="form-control" id="KupeNo" value="@Model.HayvanDetay.KupeNo" />
                                            </td>

                                            <td width="10%" style="font-weight:bold"> Adı / Takip Numarası: </td>
                                            <td width="23%" id="dtyAdi"> <input type="text" class="form-control" id="Adi" value="@Model.HayvanDetay.Adi" /> </td>

                                            <td width="10%" style="font-weight:bold"> Kayıt Tarihi: </td>
                                            <td width="23%" id="dtyKayitTarihi"> @Model.HayvanDetay.KayitTarihiFormatted </td>

                                        </tr>

                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Anne Küpe: </td>
                                            <td width="23%">
                                                <input type="text" class="form-control" id="AnneKupeNo" value="@Model.HayvanDetay.AnneKupeNo" />
                                            </td>
                                            <td width="10%" style="font-weight:bold"> Baba Küpe: </td>
                                            <td width="23%">
                                                <input type="text" class="form-control" id="BabaKupeNo" value="@Model.HayvanDetay.BabaKupeNo" />
                                            </td>
                                            <td width="10%" style="font-weight:bold"> Laktasyon Sayısı: </td>
                                            <td width="23%">
                                                <input type="number" class="form-control" id="LaktasyonSayisi" value="@Model.HayvanDetay.LaktasyonSayisi" />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Padok Bilgisi: </td>
                                            <td width="23%">
                                                @Html.DropDownList("Padoklar", new SelectList(ViewBag.Padoklar, "Value", "Text"), "Seçiniz", new { @class = "form-control" })
                                            </td>

                                            <td width="10%" style="font-weight:bold"> Irkı: </td>
                                            <td width="23%" id="dtyIrki">
                                                @Html.DropDownList("Irki", new SelectList(ViewBag.Irki, "Value", "Text"), "Seçiniz", new { @class = "form-control" })

                                            </td>
                                            <td width="10%" style="font-weight:bold"> Sürüye Giriş Tipi: </td>
                                            <td width="23%" id="dtySuruyeGirisTipi">
                                                @Html.DropDownList("SuruyeGirisTipi", new SelectList(ViewBag.SuruyeGirisTipi, "Value", "Text"), "Seçiniz", new { @class = "form-control" })
                                            </td>
                                        </tr>
                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Sürüye Giriş Tarihi: </td>
                                            <td width="23%" id="dtySuruyeGirisTarihi">
                                                <input type="date" class="form-control" id="SuruyeGirisTarihi" autocomplete="off" value="@Model.HayvanDetay.SuruyeGirisTarihi.ToString("yyyy-MM-dd")">
                                            </td>
                                            <td width="10%" style="font-weight:bold"> Doğum Tarihi: </td>
                                            <td width="23%" id="dtyDogumTarihi">
                                                <input type="date" class="form-control" id="DogumTarihi" autocomplete="off" value="@Model.HayvanDetay.DogumTarihi.ToString("yyyy-MM-dd")">
                                            </td>
                                        </tr>

                                        <tr>
                                            <td width="10%" style="font-weight:bold"> Açıklama: </td>
                                            <td width="90%" colspan="5" id="dtyAciklama">
                                                <input type="text" class="form-control" id="Aciklama" autocomplete="off" value="@Model.HayvanDetay.Aciklama">
                                            </td>
                                        </tr>

                                        <tr>
                                            <td width="10%"> &nbsp; </td>
                                            <td width="23%"> &nbsp;</td>

                                            <td width="10%" colspan="2">
                                                <button type="submit" class="btn green" onclick="HayvanGuncelle()" style="width:100%"><i class="fa fa-refresh"></i>&nbsp;&nbsp;Hayvan Bilgilerini Güncelle</button>
                                            </td>
                                            <td width="10%"> &nbsp; </td>
                                            <td width="23%"> &nbsp; </td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row" id="pnlDurumHareketleri">
                    <div class="col-md-12">
                        <div class="portlet light" style="padding:0 !important; font-size:13px !important; margin:0px !important">
                            <div class="portlet-title" style="margin-bottom:0px !important">
                                <div class="caption">
                                    <i class="icon-equalizer font-red-sunglo"></i>
                                    <span class="caption-subject font-red-sunglo bold uppercase" style="font-size:15px">HAYVAN DURUM AKIŞI</span>
                                </div>
                            </div>
                        </div>

                        <div class="portlet-body">
                            <div id="pnlDurumHareketLoading" style="width:100%; height:250px; text-align:center; display: none">
                                <img src="~/DashboardTheme/assets/admin/layout4/img/app_loading.gif" width="75" height="75" />
                            </div>
                            <div class="col-md-12" style="margin:0 !important; padding:0 !important">
                                <table class="table table-hover table-light">
                                    <tr role="row" class="heading">
                                        <th width="5%" tabindex="0" rowspan="1" colspan="1">
                                            Sıra
                                        </th>
                                        <th width="15%" tabindex="0" rowspan="1" colspan="1">
                                            Durum Bilgisi
                                        </th>
                                        <th width="15%" tabindex="0" rowspan="1" colspan="1" style="text-align:center">
                                            İşlem Tarihi
                                        </th>
                                        <th width="30%" tabindex="0" rowspan="1" colspan="1">
                                            Açıklama
                                        </th>
                                        <th width="5%" tabindex="0" rowspan="1" colspan="1" style="text-align:center">
                                            &nbsp;
                                        </th>
                                        <th width="5%" tabindex="0" rowspan="1" colspan="1" style="text-align:center">
                                            &nbsp;
                                        </th>
                                    </tr>
                                    <tbody id="tblResult">
                                        @{
                                            int sayac = 1;
                                            foreach (var item in Model.DurumHareketleri)
                                            {
                                                <tr>
                                                    <td>@Convert.ToInt32(sayac++).ToString()</td>
                                                    <td>@item.DurumBilgisi</td>
                                                    <td style="text-align:center">
                                                        <input type="date" class="form-control" id="txtIslemTarihi_@item.Id" autocomplete="off" value="@item.IslemTarihi.ToString("yyyy-MM-dd")">
                                                    </td>
                                                    <td>
                                                        <input type="text" class="form-control" placeholder="açıklama" id="txtDurumAciklama_@item.Id" autocomplete="off" value="@item.AciklamaFormatted">
                                                    </td>
                                                    <td style="text-align:right">
                                                        <button class="btn btn-sm green filter-cancel" onclick="DurumBilgisiGuncele(@item.Id)"><i class="fa fa-refresh"></i> Güncelle </button>
                                                    </td>
                                                    <td style="text-align:right">
                                                        @if (!@item.IslemSonlandiMi)
                                                        {
                                                            <button class="btn btn-sm red filter-cancel" onclick="DurumBilgisiSil(@item.Id)"><i class="fa fa-trash-o"></i> Sil</button>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <table class="table table-hover table-light">
                        <tbody>
                            <tr>
                                <td width="10%"> &nbsp; </td>
                                <td width="23%"> &nbsp;</td>

                                <td width="10%" colspan="2">
                                    <button type="submit" class="btn red" onclick="HayvanSil()" style="width:100%"><i class="fa fa-trash-o"></i>&nbsp;&nbsp;Hayvanı Sil</button>
                                </td>
                                <td width="10%"> &nbsp; </td>
                                <td width="23%"> &nbsp; </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <input type="hidden" id="hdnFotograflar" />
    <input type="hidden" id="hdnHayvanId" />
    <input type="hidden" id="hdnCinsiyetId" />
    @Html.AntiForgeryToken()
</div>

<script src="@Url.Content("~/DashboardTheme/assets/global/plugins/jquery.min.js")" type="text/javascript"></script>

<script>
    $('#Irki').val('@Model.HayvanDetay.IrkId');
    $('#SuruyeGirisTipi').val('@Model.HayvanDetay.SuruyeGirisTipId');
    $('#Padoklar').val('@Model.HayvanDetay.PadokId');
</script>

<script>

    function HayvanGuncelle() {

        var KupeNo = document.getElementById("KupeNo").value;
        var Adi = document.getElementById("Adi").value;
        var AnneKupeNo = document.getElementById("AnneKupeNo").value;
        var BabaKupeNo = document.getElementById("BabaKupeNo").value;
        var LaktasyonSayisi = document.getElementById("LaktasyonSayisi").value;
        var PadokId = document.getElementById("Padoklar").value;
        var IrkId = document.getElementById("Irki").value;
        var SuruyeGirisTipId = document.getElementById("SuruyeGirisTipi").value;
        var SuruyeGirisTarihi = document.getElementById("SuruyeGirisTarihi").value;
        var DogumTarihi = document.getElementById("DogumTarihi").value;
        var Aciklama = document.getElementById("Aciklama").value;

        var data = {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'HayvanId': @Model.HayvanDetay.Id,
            'KupeNo': KupeNo,
            'Adi': Adi,
            'AnneKupeNo': AnneKupeNo,
            'BabaKupeNo': BabaKupeNo,
            'LaktasyonSayisi': LaktasyonSayisi,
            'PadokId': PadokId,
            'IrkId': IrkId,
            'SuruyeGirisTipId': SuruyeGirisTipId,
            'SuruyeGirisTarihi': SuruyeGirisTarihi,
            'DogumTarihi': DogumTarihi,
            'Aciklama': Aciklama,
        };

        $.ajax({
            type: "POST",
            url: '@Url.Action("HayvanGuncelleAction", "Hayvanlar")',
            data: data,
            success: function (response) {
                if (response.IsSuccess) {
                    location.reload();
                }
                else {
                    ShowErrorMessageBox(response.Message);
                }
            }
        });

    }

    function DurumBilgisiGuncele(DurumBilgisiId) {

        var data = {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'Id': DurumBilgisiId,
            'HayvanId': @Model.HayvanDetay.Id,
            'IslemTarihi': document.getElementById("txtIslemTarihi_" + DurumBilgisiId).value,
            'Aciklama': document.getElementById("txtDurumAciklama_" + DurumBilgisiId).value
        };

        $.ajax({
            type: "POST",
            url: '@Url.Action("HayvanDurumGuncelleAction", "Hayvanlar")',
            data: data,
            success: function (response) {
                if (response.IsSuccess) {
                    location.reload();
                }
                else {
                    ShowErrorMessageBox(response.Message);
                }
            }
        });
    }

    function DurumBilgisiSil(DurumBilgisiId) {

         bootbox.dialog({
            message: "Durum hareketi silinecek. Onaylıyor musunuz?",
            title: "Dikkat",
            buttons: {
                success: {
                    label: "Durum hareketini sil",
                    className: "green",
                    callback: function () {

                        var data = {
                            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
                            'HayvanId': @Model.HayvanDetay.Id,
                            'DurumBilgisiId': DurumBilgisiId
                        };

                        //console.log("data: " + JSON.stringify(data));

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("HayvanDurumSilAction", "Hayvanlar")',
                            data: data,
                            success: function (response) {
                                if (response.IsSuccess) {
                                    ShowInfoFunctionBox(response.Message);
                                    location.reload();
                                }
                                else {
                                    ShowErrorMessageBox(response.Message);
                                }
                            }
                        });
                    }
                },
                error: {
                    label: "Vazgeç",
                    className: "red",
                    callback: function () {
                        return;
                    }
                }
            }
        });
    }

    function ShowHideDurumBilgisiPanel() {
        $("#pnlDurumBilgisiEkle").toggle();
    }

    function HayvanSil() {
        bootbox.dialog({
            message: "Hayvan silinecek. Bu işlem geri alınamaz. Onaylıyor musunuz?",
            title: "Uyarı !",
            buttons: {
                success: {
                    label: "Evet",
                    className: "red",
                    callback: function () {
                        var dataObject = (
                        {
                            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
                            'HayvanId': @Model.HayvanDetay.Id
                        });

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("HayvanSilAction", "Hayvanlar")',
                            data: dataObject,
                            success: function (response) {
                                console.log("Response: " + JSON.stringify(response))
                                if (response.IsSuccess == true) {
                                    bootbox.dialog({
                                        message: "İşlem başarılı",
                                        title: "Hayvan Silindi",
                                        buttons: {
                                            success: {
                                                label: "Tamam",
                                                className: "green",
                                                callback: function () {
                                                    location.href = "/Home/Index";
                                                }
                                            }
                                        }
                                    });
                                }
                                else {
                                    $('#loadingModal').modal('hide');
                                    ShowInfoFunctionBox(response.Message);
                                }
                            }
                        });
                    }
                },
                danger: {
                    label: "Vazgeç",
                    className: "green",
                    callback: function () {
                        return;
                    }
                }
            }
        });
    }

</script>

<script>
    $('#HayvanYonetimi').addClass("active");
</script>
