@using TarimCan.Models
@using TarimCan.Helper

@model List<GelirGiderModel>

@{
    ViewBag.Title = "Finans Yönetimi";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="col-md-12">
    <div class="portlet light bordered minHeight">
        <div class="portlet-title">
            <div class="caption">
                <i class="icon-equalizer font-green-sharp"></i>
                <span class="caption-subject font-green-sharp bold uppercase">FİNANS YÖNETİMİ</span> -
                <a href="https://www.youtube.com/watch?v=Zm51mv885aI&t=83s" target="_blank"> <img src="~/DashboardTheme/assets/global/ana-icons/youtube-full-logo.png" style="height:20px" title="Yardım Videosu"></a>
            </div>
            <div class="actions">
                <a href="/Finans/ManuelGelirEkle" class="btn btn-circle btn-default">
                    <i class="fa fa-arrow-up"></i>
                    <span class="hidden-480">
                        Gelir Ekle
                    </span>
                </a>
                <a href="/Finans/ManuelGiderEkle" class="btn btn-circle btn-default">
                    <i class="fa fa-arrow-down"></i>
                    <span class="hidden-480">
                        Gider Ekle
                    </span>
                </a>
            </div>
        </div>
        <div class="portlet-body form">
            <div class="row">
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12 margin-bottom-10">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-green-sharp">@ViewBag.IsletmeGelirleri <small class="font-green-sharp">TL</small></h3>
                                <small>İŞLETME GELİRLERİ</small>
                            </div>
                            <div class="icon">
                                <i class="icon-pie-chart"></i>
                            </div>
                        </div>
                        <div class="progress-info">
                            <div class="progress">
                                <span style="width: 33%;" class="progress-bar progress-bar-success green-sharp">
                                    <span class="sr-only"></span>
                                </span>
                            </div>
                            <div class="status">
                                <div class="status-title">
                                    01.01.@DateTime.Now.Year.ToString() - 31.12.@DateTime.Now.Year.ToString()
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-red-haze">@ViewBag.IsletmeGiderleri <small class="font-red-haze">TL</small></h3>
                                <small>İŞLETME GİDERLERİ</small>
                            </div>
                            <div class="icon">
                                <i class="icon-pie-chart"></i>
                            </div>
                        </div>
                        <div class="progress-info">
                            <div class="progress">
                                <span style="width: 66%;" class="progress-bar progress-bar-success red-haze">
                                    <span class="sr-only"></span>
                                </span>
                            </div>
                            <div class="status">
                                <div class="status-title">
                                    01.01.@DateTime.Now.Year.ToString() - 31.12.@DateTime.Now.Year.ToString()
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-6 col-xs-12">
                    <div class="dashboard-stat2">
                        <div class="display">
                            <div class="number">
                                <h3 class="font-blue-sharp">@ViewBag.IsletmeKarZarar <small class="font-blue-sharp">TL</small></h3>
                                <small>KAR / ZARAR</small>
                            </div>
                            <div class="icon">
                                <i class="icon-pie-chart"></i>
                            </div>
                        </div>
                        <div class="progress-info">
                            <div class="progress">
                                <span style="width: 100%;" class="progress-bar progress-bar-success blue-sharp">
                                    <span class="sr-only"></span>
                                </span>
                            </div>
                            <div class="status">
                                <div class="status-title">
                                    01.01.@DateTime.Now.Year.ToString() - 31.12.@DateTime.Now.Year.ToString()
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <div class="portlet light">
                        <div class="portlet-title tabbable-line">
                            <div class="caption caption-md">
                                <i class="icon-globe theme-font hide"></i>
                                <span class="caption-subject font-red-sunglo bold uppercase">İŞLETME GELİRLERİ</span>
                            </div>
                            <div class="actions">
                                <a href="/Finans/FinansDokumu?Tip=1&Page=0" class="btn btn-circle btn-default">
                                    <i class="fa-light fa-money-bill-1"></i>
                                    <span class="hidden-480">
                                        Tümünü Göster
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="portlet-body">
                            @{
                                if (Model != null)
                                {
                                    <table class="table table-hover table-light">
                                        <thead>
                                            <tr>
                                                <th width="10%" style="text-align:center">#</th>
                                                <th width="30%" style="text-align:center">Gelir Gider Tipi</th>
                                                <th width="25%" style="text-align:center">Tutarı</th>
                                                <th width="25%" style="text-align:center">İşlem Zamanı</th>
                                                <th width="10%" style="text-align:center"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="tblHayvanResult">
                                            @{
                                                int sayacSos = 1;

                                                foreach (var item in Model)
                                                {
                                                    if (item.IslemTipId == 1 && sayacSos <= 5)
                                                    {
                                                        <tr>
                                                            <td style="text-align:center;">
                                                                @Convert.ToInt32(sayacSos++).ToString()
                                                            </td>
                                                            <td style="text-align:center;">
                                                                @item.GelirGiderTipi
                                                            </td>
                                                            <td style="text-align:center">
                                                                @item.Tutari.ToString("#,##0") TL
                                                            </td>
                                                            <td style="text-align:center">
                                                                @item.IslemTarihi.ToString("dd.MM.yyyy")
                                                            </td>
                                                            <td align="center">
                                                                @if (item.GelirGiderTipId == 7)
                                                                {
                                                                    <span>&nbsp;</span>
                                                                }
                                                                else
                                                                {
                                                                    <a href="/Finans/FinansHareketiGuncelle?Tip=1&IslemId=@item.Id" class="btn default btn-xs green-stripe"> Güncelle </a>
                                                                }
                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                            }
                                        </tbody>
                                    </table>

                                }
                                else
                                {
                                    <span> Listelenecek veri bulunamadı...</span>
                                }
                            }
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="portlet light">
                        <div class="portlet-title tabbable-line">
                            <div class="caption caption-md">
                                <i class="icon-globe theme-font hide"></i>
                                <span class="caption-subject font-red-sunglo bold uppercase">İŞLETME GİDERLERİ</span>
                            </div>

                            <div class="actions">
                                <a href="/Finans/FinansDokumu?Tip=2&Page=0" class="btn btn-circle btn-default">
                                    <i class="fa-light fa-money-bill-1"></i>
                                    <span class="hidden-480">
                                        Tümünü Göster
                                    </span>
                                </a>
                            </div>
                        </div>
                        <div class="portlet-body">
                            @{
                                if (Model != null)
                                {
                                    <table class="table table-hover table-light">
                                        <thead>
                                            <tr>
                                                <th width="10%" style="text-align:center">#</th>
                                                <th width="30%" style="text-align:center">Gelir Gider Tipi</th>
                                                <th width="25%" style="text-align:center">Tutarı</th>
                                                <th width="25%" style="text-align:center">İşlem Zamanı</th>
                                                <th width="10%" style="text-align:center"></th>
                                            </tr>
                                        </thead>
                                        <tbody id="tblHayvanResult">
                                            @{
                                                int sayacSos = 1;

                                                foreach (var item in Model)
                                                {
                                                    if (item.IslemTipId == 2 && sayacSos <= 5)
                                                    {
                                                        <tr>
                                                            <td style="text-align:center;">
                                                                @Convert.ToInt32(sayacSos++).ToString()
                                                            </td>
                                                            <td style="text-align:center;">
                                                                @item.GelirGiderTipi
                                                            </td>
                                                            <td style="text-align:center">
                                                                @item.Tutari.ToString("#,##0") TL
                                                            </td>
                                                            <td style="text-align:center">
                                                                @item.IslemTarihi.ToString("dd.MM.yyyy")
                                                            </td>
                                                            <td align="center">

                                                                @if (item.GelirGiderTipId == 5 || item.GelirGiderTipId == 6)
                                                                {
                                                                    <span>&nbsp;</span>
                                                                }
                                                                else
                                                                {
                                                                    <a href="/Finans/FinansHareketiGuncelle?Tip=2&IslemId=@item.Id" class="btn default btn-xs green-stripe"> Güncelle </a>
                                                                }

                                                            </td>
                                                        </tr>
                                                    }
                                                }
                                            }
                                        </tbody>
                                    </table>

                                }
                                else
                                {
                                    <span> Listelenecek veri bulunamadı...</span>
                                }
                            }
                        </div>
                    </div>
                </div>

            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="portlet light">
                        <div class="portlet-title tabbable-line">
                            <div class="caption caption-md">
                                <i class="icon-globe theme-font hide"></i>
                                <span class="caption-subject font-red-sunglo bold uppercase">FİNANSAL AKIŞ</span>
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div id="chartContainer" style="height: 370px; width: 100%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @Html.AntiForgeryToken()
</div>

<script src="@Url.Content("~/DashboardTheme/assets/global/plugins/jquery.min.js")" type="text/javascript"></script>


<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<script>
    window.onload = function () {

        var chart = new CanvasJS.Chart("chartContainer", {
            animationEnabled: true,
            theme: "light2",
            title: {
                text: "İşletme Finansal İşlem Grafiği",
                fontSize: 20
            },
            axisX: {
                valueFormatString: "DD MMM",
                crosshair: {
                    enabled: true,
                    snapToDataPoint: true
                }
            },
            axisY: {
                title: "İşlem Tutarları",
                includeZero: true,
                crosshair: {
                    enabled: true,
                    snapToDataPoint: true
                }
            },
            toolTip: {
                shared: true
            },
            legend: {
                cursor: "pointer",
                verticalAlign: "bottom",
                horizontalAlign: "left",
                dockInsidePlotArea: true,
                itemclick: toogleDataSeries
            },
            data: [{
                type: "line",
                showInLegend: true,
                name: "Gelir",
                markerType: "square",
                color: "#4DB3A2",
                dataPoints: [
                    @Html.Raw(ViewBag.Gelirler)
                ]
            },
            {
                type: "line",
                showInLegend: true,
                name: "Gider",
                lineDashType: "dash",
                color: "#F08080",
                dataPoints: [
                    @Html.Raw(ViewBag.Giderler)
                ]
            }]
        });
        chart.render();

        function toogleDataSeries(e) {
            if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                e.dataSeries.visible = false;
            } else {
                e.dataSeries.visible = true;
            }
            chart.render();
        }

        console.log("Gelirler: " + '@Html.Raw(ViewBag.Gelirler)');
        console.log("Giderler: " + '@Html.Raw(ViewBag.Giderler)');

    }
</script>
