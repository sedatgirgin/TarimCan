@using TarimCan.Models
@using TarimCan.Helper

@model KullaniciModel

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
    .uploadPhoto {
        color: transparent;
    }

        .uploadPhoto::-webkit-file-upload-button {
            visibility: hidden;
        }

        .uploadPhoto::before {
            content: 'Resim Yükle';
            padding: 1rem 1rem;
            color: white;
            font-weight: 600;
            border-radius: 0.7rem !important;
            cursor: pointer;
            background-size: 200% !important;
            background-position: 100% !important;
            transition: all 250ms;
            display: inline-block;
        }

    .fileinput-button {
        position: relative;
        overflow: hidden;
    }

        .fileinput-button input {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            opacity: 0;
            -ms-filter: 'alpha(opacity=0)';
            font-size: 200px;
            direction: ltr;
            cursor: pointer;
        }

    label {
        color: black;
        font-size: 15px;
    }
</style>

@*<div class="modal fade" id="basic" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="form-horizontal">
                    <div class="form-body">
                        <div class="form-group">
                            <img class="col-md-2" src="~/DashboardTheme/assets/global/plugins/slider-layer-slider/skins/fullwidth/loading.gif" style="width:56px; height:25px"/>
                            <div class="col-md-9"><h4 class="modal-title">Veriler Güncelleniyor, bu işlem internet bağlantınıza göre uzun sürebilir. Lütfen bekleyiniz...</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>*@

<div class="col-md-12">
    <div class="portlet light bordered">
        <div class="portlet-title">
            <div class="caption">
                <i class="icon-equalizer font-red-sunglo"></i>
                <span class="caption-subject font-red-sunglo bold uppercase">KULLANICI BİLGİLERİM</span>
            </div>
        </div>

        <div class="portlet-body">
            <div class="tabbable">
                <ul class="nav nav-tabs">
                    <li class="active">
                        <a href="#tab_profil_ayarlari" data-toggle="tab">
                            Profil Ayarları
                        </a>
                    </li>
                    <li>
                        <a href="#tab_padok" data-toggle="tab" onclick="PadoklariGetir()">
                            Padoklar
                        </a>
                    </li>
                </ul>
                <div class="tab-content no-space">
                    <div class="tab-pane active" id="tab_profil_ayarlari">


                        <div class="form-horizontal">
                            <div class="form-body">

                                <div class="form-group">
                                    <label class="col-md-3 control-label">İsim Soyisim</label>
                                    <div class="col-md-4">
                                        <input type="text" id="IsimSoyisim" class="form-control" autocomplete="off" maxlength="100" value="@Model.IsimSoyisim">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Email</label>
                                    <div class="col-md-4">
                                        <input type="text" id="Email" class="form-control" autocomplete="off" maxlength="100" value="@Model.Email">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Cep Telefonu</label>
                                    <div class="col-md-4">
                                        <input type="text" id="CepTelefonu" class="form-control" autocomplete="off" maxlength="100" value="@Model.CepTelefonu">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">İşletme Adı</label>
                                    <div class="col-md-4">
                                        <input type="text" id="IsletmeAdi" class="form-control" autocomplete="off" maxlength="100" value="@Model.IsletmeAdi">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">İşletme Kayıt No</label>
                                    <div class="col-md-4">

                                        <input type="text" id="IsletmeKayitNo" class="form-control" autocomplete="off" maxlength="100" value="@Model.IsletmeKayitNo">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Adres İl</label>
                                    <div class="col-md-4">
                                        @Html.DropDownList("SehirId", new SelectList(ViewBag.Sehirler, "Value", "Text"), "Seçiniz", new { @class = "form-control col-md-2", @onchange = "AdresIlChanged(this.value)" })
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Adres İlçe</label>
                                    <div class="col-md-4">
                                        @Html.DropDownList("IlceId", new SelectList(ViewBag.AdresIlceler, "Value", "Text"), "Seçiniz", new { @class = "form-control col-md-2", @onchange = "AdresIlceChanged(this.value)" })
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Adres Mahalle</label>
                                    <div class="col-md-4">
                                        @Html.DropDownList("MahalleId", new SelectList(ViewBag.AdresMahalleler, "Value", "Text"), "Seçiniz", new { @class = "form-control col-md-2" })
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3 control-label">Profil Fotoğrafı</label>
                                    <div class="col-md-2">
                                        <span class="btn green fileinput-button">
                                            <i class="fa fa-plus"></i>
                                            <span>
                                                Fotoğraf seçiniz
                                            </span>
                                            <input id="inp" type="file" accept="image/png, image/jpeg">
                                        </span>
                                    </div>
                                    <div class="col-md-2">
                                        @if (Model.ProfilResmi != null)
                                        {
                                            <img id="imgProfilePhoto" width="100" height="150" src="~/YuklenenDosyalar/UyeFotograflari/@Model.ProfilResmi">
                                        }
                                        else
                                        {
                                            <img id="imgProfilePhoto" width="100" height="150" src="~/DashboardTheme/assets/admin/layout4/img/no_profile_photo.JPG">
                                        }
                                    </div>
                                </div>

                            </div>
                            <div class="form-actions">
                                <div class="row">
                                    <div class="col-md-offset-3 col-md-9">
                                        <button type="submit" class="btn green" onclick="Guncelle()">Kullanıcı Bilgilerimi Güncelle</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="tab_padok">
                        <div class="col-md-5">
                            <div class="portlet light" style="min-height:620px">

                                <table class="table table-hover table-light">
                                    <thead>
                                        <tr>
                                            <th style="text-align:center">Icon</th>
                                            <th style="text-align:center">Padok Adı</th>
                                            <th style="text-align:center">Padoktaki Hayvan Sayısı</th>
                                            <th style="text-align:center">&nbsp;</th>
                                            <th style="text-align:center"><a href="javascript:;" onclick="ShowHidePadokEkle()" class="btn default btn-xs green-stripe"> Yeni Padok Ekle</a></th>
                                        </tr>
                                    </thead>
                                    <tbody id="tblPadoklar">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="col-md-7" id="PadokEkleGuncelle" style="display:none">

                            <div class="portlet light">

                                <div class="portlet-title">
                                    <div class="caption">
                                        <i class="icon-equalizer font-green-sharp"></i>
                                        <span class="caption-subject font-green-sharp bold">Yeni Padok Ekle</span>
                                    </div>
                                </div>

                                <div class="portlet-body form">
                                    <!-- BEGIN FORM-->
                                    <div class="form-horizontal">

                                        <div class="form-group">
                                            <label class="col-md-2 control-label">Padok Adı</label>
                                            <div class="col-md-10">
                                                <input type="text" class="form-control" placeholder="padok adı" id="PadokAdi" maxlength="13" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-md-2 control-label">İkonu</label>
                                            <div class="col-md-10">
                                                <div id="ic-padok" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-padok')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-padok.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-boga" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-boga')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-boga.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-bos-kuru" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-bos-kuru')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-bos-kuru.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-bos" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-bos')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-bos.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-buzagi" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-buzagi')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-buzagi.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-dana" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-dana')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-dana.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-duve" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-duve')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-duve.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-gebe" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-gebe')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-gebe.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-hasta" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-hasta')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-hasta.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-inek" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-inek')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-inek.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-kuruda" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-kuruda')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-kuruda.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-sagmal" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-sagmal')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-sagmal.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-taze" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-taze')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-taze.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-tohumlama" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-tohumlama')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-tohumlama.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-tosun" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-tosun')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-tosun.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-tum-hayvanlar" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-tum-hayvanlar')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-tum-hayvanlar.png" style="width: 80px; height: 80px;"> </div>
                                                <div id="ic-tumu" style="background-color: #BC7E53; text-align:center;border-radius: 10px; width:100px; height:90px; float:left; margin:5px;" onclick="IconSec('ic-tumu')"> <img src="/DashboardTheme/assets/global/ana-icons/ic-tumu.png" style="width: 80px; height: 80px;"> </div>
                                            </div>
                                        </div>

                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="col-md-2 control-label">&nbsp;</label>
                                    <div class="col-md-10">
                                        <button id="btnTohumAyiKaydet" type="submit" class="btn green" style="width:100%" onclick="PadokKaydet()">Padok Kaydet</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="portlet-body form" style="min-height: 619px;">
            <!-- BEGIN FORM-->
            <!-- END FORM-->
        </div>
        @Html.AntiForgeryToken()
        <input type="hidden" id="hdnImgBase64" />
    </div>
    @Html.AntiForgeryToken()
</div>

<script src="@Url.Content("~/DashboardTheme/assets/global/plugins/jquery.min.js")" type="text/javascript"></script>

<script>

    var IconAdi = "";
    var LastSelectedId = "";

    $(document).ready(function () {

        if ('@Model.SehirId' != 0) {
            $('#SehirId').val('@Model.SehirId');
            $('#IlceId').val('@Model.IlceId');
            $('#MahalleId').val('@Model.MahalleId');
        }

    });

    function ShowHidePadokEkle() {

        document.getElementById('PadokEkleGuncelle').style.display = 'block';

        //if (document.getElementById('PadokEkleGuncelle').style.display == 'none') {
        //    document.getElementById('PadokEkleGuncelle').style.display = 'block';
        //}
        //else {
        //    document.getElementById('PadokEkleGuncelle').style.display = 'none';
        //}
    }

    function IconSec(idName) {

        IconAdi = idName;

        if (LastSelectedId == "") {
            LastSelectedId = idName;
        }
        else {
            document.getElementById(LastSelectedId).style.backgroundColor = '#BC7E53';
            LastSelectedId = idName;
        }

        document.getElementById(idName).style.backgroundColor = '#53BC73';
        console.log(idName);

    }

    function PadoklariGetir() {

        var data = {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
        };

        $.ajax({
            type: "POST",
            url: '@Url.Action("IsletmePadoklariniGetir", "Profil")',
            data: data,
            success: function (response) {
                console.log(JSON.stringify(response));

                document.getElementById("tblPadoklar").innerHTML = "";
                var sayac = 0;
                for (var k in response) {
                    sayac = sayac + 1;
                    $('#tblPadoklar').append('<tr> <td style="background-color: #BC7E53; text-align:center;border-radius: 10px"> <img src="/DashboardTheme/assets/global/ana-icons/' + response[k].Icon + '" style="width:80px; height:80px;"/> </td> <td> ' + response[k].PadokAdi + ' </td> <td style="text-align:center"> ' + response[k].PadoktakiHayvanSayisi + '  </td> <td> <a href="javascript:;" class="btn default btn-xs green-stripe"> Güncelle </a> </td><td style="text-align:center; cursor:pointer"> <a href="javascript:;" class="btn default btn-xs red-stripe" onclick="PadokSil(' + response[k].PadokId + ')">&nbsp;&nbsp;Sil&nbsp;&nbsp;</a> </td></tr>');
                }
            }
        });

    }

    function PadokKaydet() {
        var PadokAdi = document.getElementById("PadokAdi").value;
        if (PadokAdi == "") {
            ShowInfoFunctionBox("Padok adını giriniz...");
            return;
        }

        if (IconAdi == "") {
            ShowInfoFunctionBox("Padok resmi seçiniz...");
            return;
        }

        var data = (
        {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'PadokAdi': PadokAdi,
            'Icon': IconAdi + '.png'
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("KullaniciPadokKaydet", "Common")',
            data: data,
            success: function (response) {
                console.log("Response: " + JSON.stringify(response))
                if (response.IsSuccess) {
                    ShowInfoFunctionBox(response.Message);
                    location.reload();
                }
                else {
                    ShowErrorMessageBox(response.Message);
                }
            }
        });
    }

    function PadokSil(PadokId) {

        bootbox.dialog({
            message: "Padok silinecek ve tüm hayvanlar Genel Padoğuna atılacak. Onaylıyor musunuz?",
            title: "Dikkat",
            buttons: {
                success: {
                    label: "Padoğu sil",
                    className: "green",
                    callback: function () {

                        var data = {
                            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
                            'PadokId': PadokId
                        };

                        $.ajax({
                            type: "POST",
                            url: '@Url.Action("PadokSilAction", "Common")',
                            data: data,
                            success: function (response) {
                                if (response.IsSuccess) {
                                    ShowInfoFunctionBox(response.Message);
                                    location.reload();
                                }
                                else {
                                    ShowErrorMessageBox(response.Message);
                                }
                            }
                        });
                    }
                },
                error: {
                    label: "Vazgeç",
                    className: "red",
                    callback: function () {
                        return;
                    }
                }
            }
        });

    }

    var ImgBase64;
    document.querySelector("#inp").addEventListener("change", readFile);

    function readFile() {

        if (!this.files || !this.files[0]) return;

        const FR = new FileReader();

        FR.addEventListener("load", function (evt) {
            document.getElementById("imgProfilePhoto").style.display = 'block';
            document.getElementById("imgProfilePhoto").style.width = '100px';
            document.getElementById("imgProfilePhoto").style.height = '150px';

            document.querySelector("#imgProfilePhoto").src = evt.target.result;
            ImgBase64 = evt.target.result;
            document.getElementById("hdnImgBase64").value = evt.target.result;
            //console.log("Base64Str: " + evt.target.result);
        });

        FR.readAsDataURL(this.files[0]);
    }

    function Guncelle() {

        var IsimSoyisim = document.getElementById("IsimSoyisim").value;
        var CepTelefonu = document.getElementById("CepTelefonu").value;
        var Email = document.getElementById("Email").value;
        var SehirId = document.getElementById("SehirId").value;
        var IlceId = document.getElementById("IlceId").value;
        var MahalleId = document.getElementById("MahalleId").value;
        var IsletmeAdi = document.getElementById("IsletmeAdi").value;
        var IsletmeKayitNo = document.getElementById("IsletmeKayitNo").value;

        if (IsimSoyisim == "") {
            ShowInfoFunctionBox("İsim Soyisim bilgisi girilmesi zorunludur...");
            return;
        }

        if (CepTelefonu == "") {
            ShowInfoFunctionBox("Cep Felefonu bilgisi girilmesi zorunludur...");
            return;
        }

        if (SehirId == "0") {
            ShowInfoFunctionBox("Adres bilgisi girilmesi zorunludur...");
            return;
        }

        var data = (
        {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'IsimSoyisim': IsimSoyisim,
            'CepTelefonu': CepTelefonu,
            'Email': Email,
            'SehirId': SehirId,
            'IlceId': IlceId,
            'MahalleId': MahalleId,
            'IsletmeAdi': IsletmeAdi,
            'IsletmeKayitNo': IsletmeKayitNo,
            'ImgBase64': ImgBase64
        });

        console.log("Data: " + JSON.stringify(data));

        $.ajax({
            type: "POST",
            url: '@Url.Action("ProfilBilgileriGuncelle", "Profil")',
            data: data,
            success: function (response) {

                $('#basic').modal('show');

                console.log("Response: " + JSON.stringify(response))
                if (response.IsSuccess) {
                    ShowInfoFunctionBox(response.Message);

                    $('#basic').modal('hide');
                }
                else {
                    ShowErrorMessageBox(response.Message);
                    $('#basic').modal('hide');
                }
            } 
        });
    }

</script>

<script>

    function AdresIlChanged(val) {
        var data = {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'SehirId': val
        };

        $.ajax({
            type: "POST",
            url: '@Url.Action("IlceleriGetir", "Common")',
            data: data,
            success: function (response) {
                var ilcelerOp = "<option value=0>İlçe Seçiniz...</option>"
                for (var k in response) {
                    ilcelerOp += "<option value=" + response[k].Id + ">" + response[k].Value + "</option>"
                }
                document.getElementById("IlceId").innerHTML = ilcelerOp;
            }
        });
    }

    function AdresIlceChanged(val) {
        var data = {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'IlceId': val
        };

        $.ajax({
            type: "POST",
            url: '@Url.Action("MahalleleriGetir", "Common")',
            data: data,
            success: function (response) {
                var ilcelerOp = "<option value=0>Mahalle Seçiniz...</option>"
                for (var k in response) {
                    ilcelerOp += "<option value=" + response[k].Id + ">" + response[k].Value + "</option>"
                }
                document.getElementById("MahalleId").innerHTML = ilcelerOp;
            }
        });
    }

    $('#Profilim').addClass("active");
</script>
