@using TarimCan.Models
@using TarimCan.Helper

@{
    ViewBag.Title = "İş Ekle";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>

    .fileinput-button {
        position: relative;
        overflow: hidden;
    }

        .fileinput-button input {
            position: absolute;
            top: 0;
            right: 0;
            margin: 0;
            opacity: 0;
            -ms-filter: 'alpha(opacity=0)';
            font-size: 200px;
            direction: ltr;
            cursor: pointer;
        }

    label {
        color: black;
        font-size: 15px;
    }
</style>

<div class="col-md-12">
    <div class="portlet light bordered" style="min-height:620px">
        <div class="portlet-title">
            <div class="caption">
                <i class="icon-equalizer font-green-sharp"></i>
                <span class="caption-subject font-green-sharp bold uppercase">İŞ EKLE</span>
            </div>
        </div>
        <div class="portlet-body form">
            <!-- BEGIN FORM-->
            <div class="form-horizontal">
                @{

                    <div class="form-group">
                        <label class="col-md-3 control-label">Başlık</label>
                        <div class="col-md-4">
                            <input type="text" class="form-control" placeholder="başlık" id="Baslik" autocomplete="off">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-3 control-label">Öncelik Sırası</label>
                        <div class="col-md-4">
                            <select id="OncelikSirasi" class="form-control">
                                <option value="0">Seçiniz</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                                <option value="10">10</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-3 control-label">Açıklama</label>
                        <div class="col-md-4">
                            <textarea class="form-control" id="Aciklama" cols="5"></textarea>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-3 control-label">Ekli Dosya</label>
                        <div class="col-md-4">
                            <input id="inpUploadFile" type="file">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-md-3 control-label">&nbsp;</label>
                        <div class="col-md-4">
                            <button type="submit" class="btn green" onclick="Kaydet()" style="width:100%">Kaydet</button>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
    @Html.AntiForgeryToken()
</div>

<input type="hidden" id="hdnExcelBase64" />

<script src="@Url.Content("~/DashboardTheme/assets/global/plugins/jquery.min.js")" type="text/javascript"></script>

<script>

    document.querySelector("#inpUploadFile").addEventListener("change", ConvertExcelToBase64);
    var SelectedFileName;

    function ConvertExcelToBase64() {
        if (!this.files || !this.files[0]) return;
        const FR = new FileReader();

        SelectedFileName = this.value.replace("C:\\fakepath\\", "");
        FR.readAsDataURL(this.files[0]);

        FR.addEventListener("load", function (evt) {
            document.getElementById("hdnExcelBase64").value = evt.target.result;
            console.log("hdnExcelBase64: " + document.getElementById("hdnExcelBase64").value);
        });
    }

    function Kaydet() {

        var dataObject = ({
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'Base64File': document.getElementById("hdnExcelBase64").value,
            'SelectedFileName': SelectedFileName,
            'Baslik': document.getElementById("Baslik").value,
            'Aciklama': document.getElementById("Aciklama").value,
            'OncelikSirasi': document.getElementById("OncelikSirasi").value
        });

        $.ajax({
            type: "POST",
            url: '@Url.Action("IsKaydet", "IsTakip")',
            data: dataObject,
            success: function (response) {

                console.log(response);
                if (response.IsSuccess) {
                    location.href = "/IsTakip/Index";
                }

            },
            error: function () {
                // $("#btnLoadingButton").hide();
                // document.getElementById("spnExcelAdi").style.display = 'block';
                // document.getElementById("spnExcelAdi").innerHTML = SelectedFileName;
            },
            beforeSend: function () {
                // $("#btnLoadingButton").show();
                // $("#spnLoadButton").hide();
            },
            complete: function () {
                // $("#btnLoadingButton").hide();
                // document.getElementById("spnExcelAdi").style.display = 'block';
                // document.getElementById("spnExcelAdi").innerHTML = SelectedFileName;
            }
        });
    }

    $('#IsTakip').addClass("active");
</script>
