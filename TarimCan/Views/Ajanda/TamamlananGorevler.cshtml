@using TarimCan.Models

@model List<AjandaModel>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/DashboardTheme/LightBox/css/lightbox.css" rel="stylesheet" />

<div class="col-md-12" style="min-height:600px">

    <div class="portlet light bordered" style="min-height:620px">
        <div class="portlet light" style="padding:0 !important; font-size:13px !important; margin:0px !important">
            <div class="portlet-title" style="margin-bottom:0px !important">
                <div class="caption">
                    <i class="icon-equalizer font-red-sunglo"></i>
                    <span class="caption-subject font-red-sunglo bold uppercase" style="font-size:15px">TAMAMLANAN GÖREVLER</span> -
                    <a href="https://www.youtube.com/watch?v=Zm51mv885aI&t=83s" target="_blank"> <img src="~/DashboardTheme/assets/global/ana-icons/youtube-full-logo.png" style="height:20px" title="Yardım Videosu"></a>
                </div>

                <div class="actions">
                    <a href="/Ajanda/Index/" class="btn btn-circle btn-default">
                        <i class="fa-light fa-calendar-days"></i>
                        <span class="hidden-480">
                            Aktif Görevler
                        </span>
                    </a>
                </div>
            </div>
        </div>
        <div class="portlet-body">
            @{
                if (Model.Count > 0)
                {

                    <table class="table table-hover table-light" style="display: block; overflow-x: auto; white-space: nowrap;">
                        <thead>
                            <tr>
                                <th style="text-align:center" width="5%">No</th>
                                <th style="text-align:center" width="6%">Küpe No</th>
                                <th style="text-align:center" width="20%">Görev</th>
                                <th style="text-align:center" width="20%">Tamamlanma Notu</th>
                                <th style="text-align:center" width="6%">Adı / Takip Numarası</th>
                                <th style="text-align:center" width="6%">Kalan Gün Sayısı</th>
                                <th style="text-align:center" width="6%">Başlangıç Tarihi</th>
                                <th style="text-align:center" width="6%">Bitiş Tarihi</th>
                                <th style="text-align:center" width="6%">Görev Gün Sayısı</th>
                                <th style="text-align:center" width="6%">Ertelendi Mi</th>
                                <th style="text-align:center" width="6%">Detay</th>
                            </tr>
                        </thead>
                        <tbody id="tblHayvanResult" style="overflow-y: auto; overflow-x: hidden; ">
                            @{
                                int sayacSos = 1;

                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td style="text-align:center">@Convert.ToInt32(sayacSos++).ToString()</td>
                                        <td>
                                            @item.KupeNo
                                        </td>
                                        <td>
                                            @item.Gorev
                                        </td>
                                        <td>
                                            @item.IslemNotu
                                        </td>
                                        <td>
                                            @item.Adi
                                        </td>
                                        <td style="text-align:center">
                                            @{
                                                TimeSpan tsKalanGun = item.BaslangicTarihi - DateTime.Now;
                                                <span>@tsKalanGun.Days Gün</span>
                                            }
                                        </td>
                                        <td style="text-align:center">
                                            @item.BaslangicTarihi.ToString("dd.MM.yyyy")
                                        </td>
                                        <td style="text-align:center">
                                            @item.BitisTarihi.ToString("dd.MM.yyyy")
                                        </td>
                                        <td style="text-align:center">
                                            @{
                                                TimeSpan tsGorevGun = item.BitisTarihi - item.BaslangicTarihi;
                                                <span>@tsGorevGun.Days Gün</span>
                                            }
                                        </td>
                                        <td style="text-align:center">
                                            @{
                                                if (item.ErtelendiMi)
                                                {
                                                    <span class="label label-sm label-success"><i class="fa fa-check"></i></span>
                                                }
                                                else
                                                {
                                                    <span class="label label-sm label-danger"><i class="fa fa-times"></i></span>
                                                }
                                            }
                                        </td>
                                        <td style="text-align:center; cursor:pointer">
                                            <a href="/Hayvanlar/HayvanDetay/@item.HayvanId" class="btn default btn-xs blue-stripe"> Hayvan Detay </a>
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                    </table>

                }
                else
                {
                    <span> Listelenecek görev bulunamadı...</span>
                }
            }
        </div>
    </div>
    @Html.AntiForgeryToken()
    <input type="hidden" id="hdnAjandaId" value="0" />

    <div class="modal fade" id="AciklamaPanel" tabindex="-1" role="AciklamaPanel" aria-hidden="true" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title" style="font-weight: 700;">Görevi Tamamla</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-horizontal">
                        <div class="form-body">

                            <div class="form-group">
                                <label class="col-md-3 control-label">Yapılan İşlem</label>
                                <div class="col-md-8">
                                    <textarea class="form-control" id="txtKapatAciklama" maxlength="500"></textarea>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="col-md-3 control-label">&nbsp;</label>
                                <div class="col-md-4" style="margin-bottom:10px">
                                    <button type="submit" class="btn green" style="width:100%" onclick="GorevTamamla()">Kaydet</button>
                                </div>
                                <div class="col-md-4" style="margin-bottom:10px">
                                    <button type="submit" class="btn red" style="width:100%" onclick="HideAciklamaPanel()">İptal</button>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="@Url.Content("~/DashboardTheme/assets/global/plugins/jquery.min.js")" type="text/javascript"></script>

<script>

    function ShowAciklamaPanel(AjandaId) {
        console.log("AjandaId: " + AjandaId);
        document.getElementById("hdnAjandaId").value = AjandaId;
        $('#AciklamaPanel').modal('show');
    }

    function HideAciklamaPanel() {
        $('#AciklamaPanel').modal('hide');
    }

    function GorevTamamla() {

        var data = {
            __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val(),
            'AjandaId': document.getElementById("hdnAjandaId").value,
            'IslemNotu': document.getElementById("txtKapatAciklama").value
        };

        console.log("JSON.stringify: " + JSON.stringify(data))

        $.ajax({
            type: "POST",
            url: '@Url.Action("GorevTamamlaAction", "Ajanda")',
            data: data,
            success: function (response) {
                console.log("response: " + JSON.stringify(response))
                if (response.IsSuccess) {
                    location.reload();
                }
            }
        });
    }

</script>

<script>
    //$('#HayvanYonetimi').addClass("active");
</script>
